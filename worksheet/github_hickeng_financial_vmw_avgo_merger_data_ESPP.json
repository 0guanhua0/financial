{"sheet":1,"id":"_","name":"ESPP","conditional_formatting":{"type":"bool","criteria":"NUMBER_NOT_EQUAL_TO","args":["=ROUND(T5,3)","=O5",0,0],"ranges":["M5:M24","X5:X24","X5:X24","W5:W24","W5:W24"],"effect":["background: #FCE5CD","background: #FFFFFF","background: #A2C4C9","background: #D0E0E3"]}},
{"sheet":1,"id":"A1","data":"Input"},
{"sheet":1,"id":"A2","data":"From ESPP purchase confirmation docs"},
{"sheet":1,"id":"A4","data":"Purchase Begin Date"},
{"sheet":1,"id":"A5","type":"formula","format":"iso-date","propagate":{"end":"A24"},"dataclass":"in_ref"},
{"sheet":1,"id":"B3","data":"Input "},
{"sheet":1,"id":"B4","data":"1970-01-01","format":"iso-date"},
{"sheet":1,"id":"B5","data":"2012-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B6","data":"2013-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B7","data":"2013-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B8","data":"2014-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B9","data":"2014-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B10","data":"2015-02-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B11","data":"2015-08-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B12","data":"2016-02-01","format":"iso-date","propagate":{"end":"B13"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B14","data":"2017-02-01","format":"iso-date","propagate":{"end":"B15"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B16","data":"2018-03-01","format":"iso-date","propagate":{"end":"B17"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B18","data":"2019-03-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B19","data":"2019-09-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"B20","data":"2020-03-01","format":"iso-date","propagate":{"end":"B21"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B22","data":"2021-03-01","format":"iso-date","propagate":{"end":"B23"},"dataclass":"in_prepop"},
{"sheet":1,"id":"B24","data":"2022-03-01","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C4","data":"Purchase Date"},
{"sheet":1,"id":"C5","data":"2013-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C6","data":"=DATE(YEAR(C5),MONTH(C5)+6,DAY(C5))","type":"formula","format":"iso-date","propagate":{"end":"C8"},"dataclass":"in_prepop"},
{"sheet":1,"id":"C9","data":"2015-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C10","data":"=DATE(YEAR(C9),MONTH(C9)+6,DAY(C9))","type":"formula","format":"iso-date","propagate":{"end":"C12"},"dataclass":"in_prepop"},
{"sheet":1,"id":"C13","data":"2017-01-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C14","data":"2017-07-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C15","data":"2018-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C16","data":"2018-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C17","data":"2019-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C18","data":"2019-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C19","data":"2020-02-29","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C20","data":"2020-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C21","data":"2021-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C22","data":"2021-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C23","data":"2022-02-28","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"C24","data":"2022-08-31","format":"iso-date","dataclass":"in_prepop"},
{"sheet":1,"id":"D4","data":"Shares Purchased","note":"This is the value from \"Shares Purchased\" and NOT from \"Total shares Purchased for Offering\""},
{"sheet":1,"id":"D5","format":"int","propagate":{"end":"D24"},"dataclass":"in"},
{"sheet":1,"id":"D26","data":"=SUM(D5:D24)","type":"formula","format":"int","dataclass":"info"},
{"sheet":1,"id":"E4","data":"Grant Date Market Value","format":"financial"},
{"sheet":1,"id":"E5","data":"89","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E6","data":"78.79","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E7","data":"82.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E8","data":"90.14","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E9","data":"98.33","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E10","data":"77.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E11","data":"89.13","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E12","data":"45.49","format":"financial","propagate":{"end":"E13"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E14","data":"87.19","format":"financial","propagate":{"end":"E15"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E16","data":"123.66","format":"financial","propagate":{"end":"E17"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E18","data":"178.2","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E19","data":"141.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"E20","data":"120.52","format":"financial","propagate":{"end":"E21"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E22","data":"140.41","format":"financial","propagate":{"end":"E23"},"dataclass":"in_prepop"},
{"sheet":1,"id":"E24","data":"115.91","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F4","data":"Purchase Value per Share"},
{"sheet":1,"id":"F5","data":"76.48","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F6","data":"82.19","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F7","data":"90.14","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F8","data":"99.36","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F9","data":"77.1","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F10","data":"89.13","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F11","data":"45.75","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F12","data":"72.98","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F13","data":"87.54","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F14","data":"92.71","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F15","data":"131.75","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F16","data":"153.26","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F17","data":"171.81","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F18","data":"141.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F19","data":"120.52","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F20","data":"144.44","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F21","data":"138.21","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F22","data":"148.87","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F23","data":"117.32","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"F24","data":"116.03","format":"financial","dataclass":"in_prepop"},
{"sheet":1,"id":"G4","data":"Current Contributions"},
{"sheet":1,"id":"G5","format":"financial","propagate":{"end":"G24"},"dataclass":"in"},
{"sheet":1,"id":"H3","data":"Derived - informational only"},
{"sheet":1,"id":"H4","data":"Total Price"},
{"sheet":1,"id":"H5","data":"=D5*L5","type":"formula","format":"financial","propagate":{"end":"H24"},"dataclass":"info"},
{"sheet":1,"id":"H26","data":"=SUM(H3:H24)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"I3","data":"Derived - should match vlaues from ESPP purchase confirmation"},
{"sheet":1,"id":"I4","data":"Previous Carry Forward"},
{"sheet":1,"id":"I5","format":"financial","dataclass":"in","note":"Put the Previous Carry Forward form your earliest ESPP confirmation for shares you still own into this cell and it'll propagate down.\nIt doesn't matter that it's on a different row as it's only when you start purchasing shares that it'll have an effect.\nAlternatively you can 0 those rows for which you don't have a purchase and enter your earliest Carry Forward into the precise row."},
{"sheet":1,"id":"I6","data":"=K5","type":"formula","format":"financial","propagate":{"end":"I8"},"dataclass":"in_prepop"},
{"sheet":1,"id":"I9","format":"financial","dataclass":"in"},
{"sheet":1,"id":"I10","data":"=K9","type":"formula","format":"financial","propagate":{"end":"I24"},"dataclass":"in_prepop"},
{"sheet":1,"id":"J4","data":"Total Contributions"},
{"sheet":1,"id":"J5","data":"=I5+G5","type":"formula","format":"financial","propagate":{"end":"J24"},"dataclass":"info"},
{"sheet":1,"id":"K4","data":"Carry Forward"},
{"sheet":1,"id":"K5","data":"=J5-H5","type":"formula","format":"financial","propagate":{"end":"K24"},"dataclass":"info"},
{"sheet":1,"id":"L4","data":"Purchase Price per Share"},
{"sheet":1,"id":"L5","data":"=0.85*MIN(E5,F5)","type":"formula","format":"int_4dp","propagate":{"end":"L11"},"dataclass":"info"},
{"sheet":1,"id":"L12","data":"=ROUND(0.85*MIN(E12,F12),2)","type":"formula","format":"int_2dp","propagate":{"end":"L24"},"dataclass":"info"},
{"sheet":1,"id":"M2","data":"From eTrade","format":"int_3dp"},
{"sheet":1,"id":"M3","data":"Input - alternate for cross check","format":"int_3dp"},
{"sheet":1,"id":"M4","data":"Share amounts from eTrade","format":"int_3dp","note":"The quantities of converted shares from eTrade lots.\nThe colour of the cell will alter slightly if the value here does not equal the value calculated via AVGO ratio.\nYou can toggle whether to use this manual value or the calculated value in the Tweaks on the first Sheet."},
{"sheet":1,"id":"M5","format":"int_3dp","propagate":{"end":"M24"},"dataclass":"in_opt"},
{"sheet":1,"id":"M26","data":"=SUM(M5:M24)","type":"formula","format":"int_3dp","dataclass":"info"},
{"sheet":1,"id":"N3","data":"Use for fraction","format":"int_3dp","note":"If the fractional share should come out of a specific lot, or set of lots, check those lots here. If multiple are selected the sheet will spread the fraction equally over those lots, accounting for differences in cost-basis.\nYou REALLY don't want it to come out of an ESPP lot as that's a sale and will incur the ordinary income portion of tax shown in column AB.\nFor me, eTrade took the entire fraction from a single lot and I expect that's what happened for most people."},
{"sheet":1,"id":"N4","format":"int_3dp"},
{"sheet":1,"id":"N5","type":"checkbox","format":"int_3dp","validation":{"type":"CHECKBOX","enforced":false,"help":""},"propagate":{"end":"N24"},"dataclass":"in"},
{"sheet":1,"id":"N26","data":"=COUNTIF(N3:N24, TRUE)","type":"formula"},
{"sheet":1,"id":"O1","data":"Output","format":"financial"},
{"sheet":1,"id":"O2","data":"Calculated","format":"financial"},
{"sheet":1,"id":"O3","data":"Cash received","format":"financial"},
{"sheet":1,"id":"O4","data":"Pro-rata cash","format":"financial"},
{"sheet":1,"id":"O5","data":"=Reference!$B$4*Reference!$B$3*D5","type":"formula","format":"financial","propagate":{"end":"O24"},"dataclass":"info"},
{"sheet":1,"id":"O26","data":"=SUM(O3:O24)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"P4","data":"Pro-rata cash (manual shares)","format":"financial"},
{"sheet":1,"id":"P5","data":"=iferror(LET(ratio, M5/(0.252*D5),(1-ratio) * Reference!$B$3 * D5),0)","type":"formula","format":"financial","propagate":{"end":"P24"},"dataclass":"info"},
{"sheet":1,"id":"P26","data":"=SUM(P5:P24)","type":"formula","format":"financial"},
{"sheet":1,"id":"Q3","data":"Basis adjustment for Dell dividends","format":"financial"},
{"sheet":1,"id":"Q4","data":"1st special divident basis adjustment","format":"financial"},
{"sheet":1,"id":"Q5","data":"=IF(C5<Reference!$B$26,Reference!$C$26,0)","type":"formula","format":"financial","propagate":{"end":"Q24"},"dataclass":"info"},
{"sheet":1,"id":"R4","data":"2nd dividend basis adjustment","format":"financial"},
{"sheet":1,"id":"R5","data":"=IF(C5<Reference!$B$27,Reference!$C$27,0)","type":"formula","format":"financial","propagate":{"end":"R24"},"dataclass":"info"},
{"sheet":1,"id":"S3","data":"Cost basis entering merger","format":"financial"},
{"sheet":1,"id":"S4","data":"VMW cost-basis per share","format":"financial","note":"The cost basis is the actual price paid per share times the number of shares, plus the ordinary income."},
{"sheet":1,"id":"S5","data":"=(L5 /0.85)-Q5-R5","type":"formula","format":"financial","propagate":{"end":"S24"},"dataclass":"info"},
{"sheet":1,"id":"T3","data":"Shares received","format":"financial"},
{"sheet":1,"id":"T4","data":"AVGO converted shares","format":"financial"},
{"sheet":1,"id":"T5","data":"=SWITCH(Summary!$K$26,\"Calculated\", D5*Reference!$B$5*Reference!$B$6, \"Manual entries\",M5)","type":"formula","format":"int_3dp","propagate":{"end":"T24"},"dataclass":"info"},
{"sheet":1,"id":"T26","data":"=SUM(T3:T24)","type":"formula","format":"int_4dp","dataclass":"info"},
{"sheet":1,"id":"U3","data":"Alternate gain calculation","format":"financial"},
{"sheet":1,"id":"U4","data":"Gain (cash+FMV AVGO-basis)","format":"financial"},
{"sheet":1,"id":"U5","data":"=MAX(SWITCH(Summary!$K$27,\"Derived from calculated values\",O5,\"Derived from manual entries\",P5)+(T5*Reference!$B$18)-(D5*S5),0)","type":"formula","format":"financial","propagate":{"end":"U24"},"dataclass":"info"},
{"sheet":1,"id":"U26","data":"=SUM(U3:U24)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"V2","format":"financial"},
{"sheet":1,"id":"V4","data":"Fractional share"},
{"sheet":1,"id":"V5","data":"=IF(N5,Summary!$C$41/ ($N$26+RSU!J$84), 0)","type":"formula","format":"int_4dp","propagate":{"end":"V24"},"dataclass":"info"},
{"sheet":1,"id":"V26","data":"=SUM(V3:V24)","type":"formula","dataclass":"out_now"},
{"sheet":1,"id":"W2","data":"Now","format":"financial"},
{"sheet":1,"id":"W3","data":"Gain"},
{"sheet":1,"id":"W4","data":"Fraction"},
{"sheet":1,"id":"W5","data":"=IF(N5,(Reference!$B$23 - AA5) * V5, 0)","type":"formula","format":"int_4dp","propagate":{"end":"W24"},"dataclass":"out_now"},
{"sheet":1,"id":"W26","data":"=SUM(W5:W24)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"X4","data":"Merger","format":"financial"},
{"sheet":1,"id":"X5","data":"=MIN(O5,U5)","type":"formula","format":"financial","propagate":{"end":"X24"},"dataclass":"out_now"},
{"sheet":1,"id":"X26","data":"=SUM(X5:X24)","type":"formula","format":"financial","dataclass":"info"},
{"sheet":1,"id":"Y3","data":"Treatment"},
{"sheet":1,"id":"Y4","data":"Income & short term gain","format":"financial","note":"This pulls in the ordinary income portion for the fractional share if associated with the lot."},
{"sheet":1,"id":"Y5","data":"=IF(DATEDIF(C5,Reference!$B$28,\"Y\")>=1,0,W5+X5)+iferror(((AD5/D5)*V5),0)","type":"formula","format":"financial","propagate":{"end":"Y24"},"dataclass":"out_now"},
{"sheet":1,"id":"Y26","data":"=SUM(Y5:Y24)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"Z4","data":"Long term gain"},
{"sheet":1,"id":"Z5","data":"=IF(DATEDIF(C5,Reference!$B$28,\"Y\")>=1,W5+X5,0)","type":"formula","format":"financial","propagate":{"end":"Z24"},"dataclass":"out_now"},
{"sheet":1,"id":"Z26","data":"=SUM(Z5:Z24)","type":"formula","format":"financial","dataclass":"out_now"},
{"sheet":1,"id":"AA2","data":"Future"},
{"sheet":1,"id":"AA3","data":"Reference for future sale"},
{"sheet":1,"id":"AA4","data":"New cost basis per share","note":"Cost basis on sale for disqualified ESPP includes the reported ordinary income.\n\nSee https://github.com/hickeng/financial/issues/15#issuecomment-1947700730"},
{"sheet":1,"id":"AA5","data":"=IFERROR(((S5*D5) - O5 + X5 + IF(AC5, 0, AD5))/SWITCH(Summary!$K$26, \"Calculated\", T5, \"Manual entries\", M5), 0)","type":"formula","format":"financial","propagate":{"end":"AA24"},"dataclass":"out_future"},
{"sheet":1,"id":"AB4","data":"Potential Captial Gain (AVGO)"},
{"sheet":1,"id":"AB5","data":"=(Reference!$B$10-AA5)*((SWITCH(Summary!$K$26, \"Calculated\", T5, \"Manual entries\", M5)) - V5)","type":"formula","format":"financial","propagate":{"end":"AB24"},"dataclass":"out_future"},
{"sheet":1,"id":"AB26","data":"=SUM(AB5:AB24)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AC4","data":"Qualified"},
{"sheet":1,"id":"AC5","data":"=AND(DATEDIF(B5,Reference!$B$29,\"Y\")>=1, DATEDIF(A5, Reference!$B$29, \"Y\")>=2)","type":"formula","format":"financial","propagate":{"end":"AC24"},"dataclass":"info"},
{"sheet":1,"id":"AC26","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AD4","data":"Pending Ordinary Income"},
{"sheet":1,"id":"AD5","data":"=IF(AC5,D5*0.15*MIN(E5,F5),D5*(F5-L5))","type":"formula","format":"financial","propagate":{"end":"AD24"},"dataclass":"out_future"},
{"sheet":1,"id":"AD26","data":"=SUM(AD5:AD24)","type":"formula","format":"financial","dataclass":"out_future"},
{"sheet":1,"id":"AE4","data":"Long term Captial Gain"},
{"sheet":1,"id":"AE5","data":"=AB5","type":"formula","format":"financial","propagate":{"end":"AE24"},"dataclass":"out_future"},
{"sheet":1,"id":"AE26","data":"=SUM(AE5:AE24)","type":"formula","format":"financial","dataclass":"out_future"},
